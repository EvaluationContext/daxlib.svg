{% if site.giscus.enabled %}
<div id="giscus-comments" class="giscus-container">
  <script src="https://giscus.app/client.js"
          data-repo="{{ site.giscus.repo }}"
          data-repo-id="{{ site.giscus.repo_id }}"
          data-category="{{ site.giscus.category }}"
          data-category-id="{{ site.giscus.category_id }}"
          data-mapping="{{ site.giscus.mapping }}"
          data-strict="0"
          data-reactions-enabled="{{ site.giscus.reactions_enabled }}"
          data-emit-metadata="{{ site.giscus.emit_metadata }}"
          data-input-position="{{ site.giscus.input_position }}"
          data-theme="{{ site.giscus.theme }}"
          data-lang="{{ site.giscus.lang }}"
          data-loading="{{ site.giscus.loading }}"
          crossorigin="anonymous"
          async>
  </script>
</div>

<style>
.giscus-container {
  margin-top: 2rem;
  padding-top: 2rem;
  border-top: 1px solid #e1e4e8;
}

.giscus-container .giscus {
  max-width: 100%;
}

/* Dark theme support */
@media (prefers-color-scheme: dark) {
  .giscus-container {
    border-top-color: #30363d;
  }
}

/* Responsive adjustments */
@media (max-width: 768px) {
  .giscus-container {
    margin-top: 1.5rem;
    padding-top: 1.5rem;
  }
}
</style>

<script>
// Theme switching support for Giscus
function updateGiscusTheme() {
  const giscusFrame = document.querySelector('iframe.giscus-frame');
  if (giscusFrame) {
    const isDark = document.documentElement.getAttribute('data-color-mode') === 'dark' ||
                   window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = isDark ? 'dark' : 'light';
    
    giscusFrame.contentWindow.postMessage({
      giscus: {
        setConfig: {
          theme: theme
        }
      }
    }, 'https://giscus.app');
  }
}

// Listen for theme changes
const observer = new MutationObserver(function(mutations) {
  mutations.forEach(function(mutation) {
    if (mutation.type === 'attributes' && mutation.attributeName === 'data-color-mode') {
      updateGiscusTheme();
    }
  });
});

observer.observe(document.documentElement, {
  attributes: true,
  attributeFilter: ['data-color-mode']
});

// Update theme when Giscus loads
window.addEventListener('message', function(event) {
  if (event.origin !== 'https://giscus.app') return;
  if (event.data.giscus && event.data.giscus.ready) {
    updateGiscusTheme();
  }
});
</script>
{% endif %}